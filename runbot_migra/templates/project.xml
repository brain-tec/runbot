<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="runbot_migra.project_list">
    <t t-call="website.layout">
     <div class="container-fluid">
       <div class="row">
         <div class="col-md-12">
           <table class="table table-condensed table-stripped" style="table-layout: initial;">
               <thead>
                   <tr>
                       <th>Project</th>
                       <th>Builds</th>
                   </tr>
               </thead>
               <t t-foreach="projects" t-as="project">
                 <tr>
                  <td><a t-attf-href="/migrabot/project/{{project.id}}"><t t-esc="project.name"/></a></td>
                  <td><t t-esc="len(project.build_ids)"/></td>
                </tr>
               </t>
           </table>
         </div>
       </div>
     </div>
    </t>
    </template>

    <template id="runbot_migra.project">
      <t t-call="website.layout">
       <div class="container-fluid">
        <section class="row">
          <h2>Project <t t-esc="project.name"/>&amp;nbsp;<small>(<t t-esc="project.migration_scripts_branch"/>)</small></h2>
            <section>
              <div class="row">
                <div class="col-sm-6">
                  <h3>Hashes</h3>
                  <dl class="row small">
                    <t t-foreach="hashes" t-as="hash">
                      <dt class="col-sm-3"><t t-esc="'/'.join(hash.split('/')[-2:])"/></dt>
                      <dd class="col-sm-9"><t t-esc="hashes[hash]"/></dd>
                    </t>
                  </dl>
                </div>
                <div class="col-sm-6">
                  <dl class="row small">
                    <t t-foreach="project.version_ids" t-as="v">
                          <dt class="col-sm-3"><h4><t t-esc="v.name"/></h4></dt>
                          <dd class="col-sm-9">
                            <h4>
                              <span class="badge badge-success"><t t-esc="project.build_ids.search_count([('project_id', '=', project.id), ('result', '=', 'ok'), ('version_src', '=', v.name)])"/></span>
                              <span class="badge badge-danger"><t t-esc="project.build_ids.search_count([('project_id', '=', project.id), ('result', '=', 'ko'), ('version_src', '=', v.name)])"/></span>
                            </h4>
                          </dd>
                    </t>
                    <dt class="col-sm-3"><h4>Total</h4></dt>
                    <dd class="col-sm-9">
                      <h4>
                        <span class="badge badge-success"><t t-esc="project.build_ids.search_count([('project_id', '=', project.id), ('result', '=', 'ok')])"/></span>
                        <span class="badge badge-danger"><t t-esc="project.build_ids.search_count([('project_id', '=', project.id), ('result', '=', 'ko')])"/></span>
                      </h4>
                    </dd>
                  </dl>
                </div>
              </div>
            </section>
            <section class="col-md-12">
              <div class="row">
              <div class="col-md-2"></div>
              <div class="col-md-8">
              <ul style="display: flex;" t-attf-class="list-unstyled">
                <li style="flex: 1;"><span  class="font-weight-bold">Addon</span></li>
                <t t-foreach="project.version_ids.mapped('name')" t-as="version">
                  <li style="flex: 1;"><span class="font-weight-bold"><t t-esc="version"/></span></li>
                </t>
              </ul>
            <t t-foreach="addons_builds" t-as="addon_build">
                <ul style="display: flex;" t-attf-class="list-unstyled list-group list-group-horizontal">
                  <li style="flex: 1;"><t t-esc="addon_build"/></li>
                  <t t-foreach="project.version_ids.mapped('name')" t-as="version">
                    <t t-set="build" t-value="addons_builds[addon_build][version]"/>
                    <t t-set="klass">text-success</t>
                    <t t-if="build.result == 'ko'"><t t-set="klass">text-danger</t></t>
                    <t t-if="build.state != 'done'"><t t-set="klass">text-info</t></t>
                    <t t-if="build.state == 'done'">
                      <li style="flex: 1;"><a t-attf-class="{{klass}}" t-attf-href="/migrabot/build/{{build.id}}"><t t-esc="build.result"/></a></li>
                    </t>
                    <t t-else="">
                      <li style="flex: 1;"><span t-attf-class="{{klass}}">Still building <t t-esc="build.state"/></span></li>
                    </t>
                  </t>
                </ul>
            </t>
          </div>
          <div class="col-md-2"></div>
        </div>
            </section>
        </section>
       </div>
      </t>
    </template>
  </data>
</odoo>