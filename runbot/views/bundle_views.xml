<odoo>
  <data>

   <record id="view_runbot_project" model="ir.ui.view">
        <field name="model">runbot.project</field>
        <field name="arch" type="xml">
            <form string="Projects">
                <group>
                    <field name="name"/>
                    <field name="group_ids"/>
                    <field name="trigger_ids"/>
                </group>
            </form>
        </field>
    </record>


    <record id="view_runbot_bundle" model="ir.ui.view">
        <field name="model">runbot.bundle</field>
        <field name="arch" type="xml">
            <form string="Bundles">
                <div class="oe_button_box" name="button_box">
                    <button name="action_open_frontend" title="Open Frontend" aria-label="Open" type="object" icon="fa-play" class="oe_link"/>
                </div>
                <group>
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="sticky" readonly="0"/>
                    <field name="to_upgrade" readonly="0"/>
                    <field name="is_base"/>
                    <field name="base_id"/>
                    <field name="defined_base_id"/>
                    <field name="version_id"/>
                    <field name="no_build"/>
                    <field name="no_auto_run"/>
                    <field name="priority"/>
                    <field name="build_all"/>
                    <field name="dockerfile_id"/>
                    <field name="host_id" readonly="0"/>
                    <field name="branch_ids">
                        <tree>
                            <field name="dname"/>
                            <field name="remote_id"/>
                            <field name="pull_head_name"/>
                            <field name="target_branch_name"/>
                        </tree>
                    </field>
                    <field string="Trigger customisations" name="trigger_custom_ids">
                        <tree editable="bottom">
                            <field name="trigger_id" domain="[('project_id', '=', parent.project_id)]"/>
                            <field name="config_id"/>
                        </tree>
                    </field>
                    <field string="Last batches" name="last_batchs">
                        <tree>
                            <field name="state"/>
                            <field name="commit_link_ids"/>
                            <field name="slot_ids"/>
                        </tree>
                    </field>

                </group>
            </form>
        </field>
    </record>
    <record id="view_runbot_bundle_tree" model="ir.ui.view">
        <field name="model">runbot.bundle</field>
        <field name="arch" type="xml">
            <tree string="Bundle" decoration-primary="sticky == True" decoration-muted="pr_state == 'nopr'" decoration-success="pr_state == 'done'" decoration-warning="pr_state == 'open'">
                <field name="project_id"/>
                <field name="name"/>
                <field name="version_number"/>
                <field name="is_base"/>
                <field name="sticky"/>
                <field name="to_upgrade"/>
                <field name="no_build"/>
                <field name="branch_ids"/>
                <field name="version_id"/>
                <field name="labels" widget="many2many_tags" readonly="1"/>
                <button name="action_open_frontend" title="Open Frontend" aria-label="Open" type="object" icon="fa-play" class="oe_link"/>
                <field name="pr_state"/>
            </tree>
        </field>
    </record>

    <record id="runbot_bundle_search_view" model="ir.ui.view">
      <field name="name">runbot.bundle.filter</field>
      <field name="model">runbot.bundle</field>
      <field name="arch" type="xml">
        <search string="Search regex">
          <field name="name"/>
          <field name="labels"/>
           <filter string="Has Open PR" name="open_pr" domain="[('pr_state', '=', 'open')]"/>
           <filter string="All PR Closed" name="open_pr" domain="[('pr_state', '=', 'done')]"/>
           <filter string="Has no PR" name="nopr" domain="[('pr_state', '=', 'nopr')]"/>
        </search>
      </field>
    </record>

    <record id="view_runbot_batch" model="ir.ui.view">
        <field name="model">runbot.batch</field>
        <field name="arch" type="xml">
            <form string="Batch">
                <group>
                    <field name="last_update"/>
                    <field name="bundle_id"/>
                    <field name="state"/>
                    <field name="commit_link_ids">
                        <tree>
                            <field name="commit_id"/>
                            <field name="match_type"/>
                        </tree>
                    </field>
                    <field name="slot_ids">
                        <tree>
                            <field name="trigger_id"/>
                            <field name="build_id"/>
                            <field name="link_type"/>
                        </tree>
                    </field>
                </group>
            </form>
        </field>
    </record>
    <record id="view_runbot_batch_tree" model="ir.ui.view">
        <field name="model">runbot.batch</field>
        <field name="arch" type="xml">
            <tree string="Batchs">
                <field name="bundle_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_runbot_version_tree" model="ir.ui.view">
        <field name="model">runbot.version</field>
        <field name="arch" type="xml">
            <tree string="Version">
                <field name="name"/>
                <field name="number"/>
                <field name="is_major"/>
                <field name="dockerfile_id"/>
            </tree>
        </field>
    </record>

    <record id="view_runbot_branch_label_form" model="ir.ui.view">
        <field name="model">runbot.branch.label</field>
        <field name="arch" type="xml">
            <form string="Label">
                <group>
                    <field name="name"/>
                </group>
                <field name="bundle_ids" nolabel="1" widget="many2many" options="{'not_delete': True, 'no_create': True}">
                    <tree string="Bundle" decoration-primary="sticky == True" decoration-muted="pr_state == 'nopr'" decoration-success="pr_state == 'done'" decoration-warning="pr_state == 'open'">
                        <field name="project_id"/>
                        <field name="name"/>
                        <field name="version_number"/>
                        <field name="is_base"/>
                        <field name="sticky"/>
                        <field name="to_upgrade"/>
                        <field name="no_build"/>
                        <field name="branch_ids"/>
                        <field name="version_id"/>
                        <field name="labels" widget="many2many_tags" readonly="1"/>
                        <button name="action_open_frontend" title="Open Frontend" aria-label="Open" type="object" icon="fa-play" class="oe_link"/>
                        <field name="pr_state"/>
                    </tree>
                </field>
            </form>
        </field>
    </record>

    <record id="view_runbot_branch_label_tree" model="ir.ui.view">
        <field name="model">runbot.branch.label</field>
        <field name="arch" type="xml">
            <tree string="Label">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="action_bundle" model="ir.actions.act_window">
        <field name="name">Bundles</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">runbot.bundle</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="action_bundle_project" model="ir.actions.act_window">
        <field name="name">Projects</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">runbot.project</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="action_bundle_version" model="ir.actions.act_window">
        <field name="name">Versions</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">runbot.version</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="action_bundle_batch" model="ir.actions.act_window">
        <field name="name">Batches</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">runbot.batch</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_bundle_label" model="ir.actions.act_window">
        <field name="name">Labels</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">runbot.branch.label</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_bundle" name="Bundle" parent="runbot_menu_root"/>
    <menuitem id="menu_bundle_bundle" action="action_bundle" parent="menu_bundle"/>
    <menuitem id="menu_bundle_project" action="action_bundle_project" parent="menu_bundle"/>
    <menuitem id="menu_bundle_version" action="action_bundle_version" parent="menu_bundle"/>
    <menuitem id="menu_bundle_batch" action="action_bundle_batch" parent="menu_bundle"/>
    <menuitem id="menu_bundle_label" action="action_bundle_label" parent="menu_bundle"/>
  </data>
</odoo>
