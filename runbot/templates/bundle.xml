<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="runbot.bundle">
            <t t-call='website.layout'>
                <div class="container-fluid">
                    <div class="row">
                        <div class='col-md-12'>
                            <div class="navbar navbar-default">
                                <span class="text-center" style="font-size: 18px;">
                                    <t t-esc="bundle.name"/>
                                    <i t-if="bundle.sticky" class="fa fa-star" style="color: #f0ad4e" />
                                </span>
                                <span class="pull-right">
                                    <t t-call="website.pager" />
                                </span>
                            </div>
                            <div>
                                <table class="table table-condensed table-responsive table-stripped">
                                    <tr>
                                        <td>Version</td>
                                        <td>
                                            <t t-esc="bundle.version_id.name"/>
                                            <a t-if="more" t-attf-href="/runbot/bundle/{{bundle.id}}/force" title="Force A New Batch">
                                                <i class="fa fa-refresh"/>
                                            </a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Branches</td>
                                        <td>
                                            <div t-foreach="bundle.branch_ids.sorted(key=lambda b: (b.remote_id.repo_id.sequence, b.remote_id.repo_id.id, b.is_pr))" t-as="branch">
                                                <small>
                                                    <a t-att-href="branch.branch_url" t-esc="branch.dname" title="View Branch on Github"/>
                                                    <a t-if="more" class="fa fa-cog" t-attf-href="/web/#id={{branch.id}}&amp;view_type=form&amp;model=runbot.branch" target="new" title="View Branch in Backend"/>
                                                </small>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr t-if="more">
                                        <td>Category</td>
                                        <td t-esc="bundle.project_id.name"/>
                                    </tr>
                                    <tr t-if="more">
                                        <td>New build enabled</td>
                                        <td>
                                            <i t-attf-class="fa fa-{{'times' if bundle.no_build else 'check'}}"/>
                                        </td>
                                    </tr>
                                    <tr t-if="more">
                                        <td>Modules</td>
                                        <td t-esc="bundle.modules or '/'"/>
                                    </tr>
                                </table>
                            </div>
                            <div t-foreach="bundle.consistency_warning()" t-as="warning" t-esc="warning[1]" t-attf-class="alert alert-{{warning[0]}}"/>
                            <table class="table table-condensed table-stripped" style="table-layout: initial;">
                                <thead>
                                    <tr>
                                        <th/>
                                        <th t-if="more">Create date</th>
                                        <th t-if="more">Last update</th>
                                        <th t-if="more">state</th>
                                        <th>Commits</th>
                                        <th>Builds</th>
                                    </tr>
                                </thead>
                                <t t-foreach="batchs" t-as="batch">
                                    <tr>
                                        <td>
                                            <a t-attf-href="/runbot/batch/#{batch.id}">
                                                <span class="badge badge-light" t-esc="batch.get_formated_age()" title="View Batch"/>
                                            </a>
                                        </td>
                                        <td t-if="more" t-esc="batch.create_date"/>
                                        <td t-esc="batch.last_update" t-if="more"/>
                                        <td t-esc="batch.state" t-if="more"/>
                                        <td>
                                            <t t-foreach="batch.commit_link_ids.sorted(lambda cl: (cl.commit_id.repo_id.sequence, cl.commit_id.repo_id.id))" t-as="commit_link">
                                                <a t-attf-href="/runbot/commit/#{commit_link.commit_id.id}">
                                                    <samp class="badge badge-info">
                                                        <i class="fa fa-fw fa-hashtag" t-if="commit_link.match_type == 'new'"/>
                                                        <i class="fa fa-fw fa-refresh" t-if="commit_link.match_type == 'head'"/>
                                                        <i class="fa fa-fw fa-code-fork" t-if="commit_link.match_type == 'base_match'"/>
                                                        <i class="fa fa-fw fa-clock-o" t-if="commit_link.match_type == 'base_head'"/>
                                                        <t t-esc="commit_link.commit_id.dname"/>
                                                    </samp>
                                                </a>
                                            </t>
                                        </td>
                                        <t t-set="klass">default</t>
                                        <t t-if="batch.state=='ready'">
                                            <t t-set="klass">success</t>
                                        </t>
                                        <td t-attf-class="bg-{{klass}}-light">
                                            <t t-foreach="batch.slot_ids" t-as="slot">
                                                <t t-call="runbot.slot_button"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </table>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>
