<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <template id="runbot.base_page">
      <html>
        <head>
          <title t-esc="title or 'Runbot'"/>
          <link rel="stylesheet" type="text/css" href="/web/static/lib/bootstrap/css/bootstrap.css"/>
          <link rel="stylesheet" type="text/css" href="/web/static/lib/fontawesome/css/font-awesome.css"/>
          <link rel="stylesheet" type="text/css" href="/runbot/static/src/css/runbot.css"/>

          <script src="/web/static/lib/jquery/jquery.js" type="text/javascript"/>
          <script type="text/javascript" src="/web/static/lib/popper/popper.js"/>
          <script type="text/javascript" src="/web/static/lib/bootstrap/js/util.js"/>
          <script type="text/javascript" src="/web/static/lib/bootstrap/js/collapse.js"/>
          <script type="text/javascript" src="/web/static/lib/bootstrap/js/dropdown.js"/>

          <t t-if="head" t-raw="head"></t>

        </head>
        <body>
          <t t-raw="0"/>
        </body>
      </html>
    </template>

    <template id="runbot.base_layout" inherit_id="runbot.base_page" primary="True">
        <xpath expr="//body" position="replace">
          <body>
            <header>
              <nav t-if="project" class="navbar navbar-expand-md navbar-light bg-light">
                <a t-attf-href="/runbot/{{slug(project)}}">
                    <b style="color:#777;">
                        <t t-esc="project.name"/>
                    </b>
                </a>
              </nav>
          </header>
          <t t-raw="0"/>
        </body>
      </xpath>
    </template>

    <template id="runbot.main">
      <t t-call="runbot.base_page">
        <t t-set="head">
          <script type="text/javascript">
              base_data = <t t-raw="json.dumps(data)"/>;
          </script>
          <script src="/web/static/lib/owl/owl.js"></script>
          <script src="/runbot/static/src/js/main.js"></script>
        </t>
      </t>
    </template>   

    <template id="runbot.batch_tile">
      <t t-set="klass">info</t>
      <t t-if="batch.state=='skipped'" t-set="klass">killed</t>
      <t t-if="batch.state=='done' and all(slot.build_id.global_result == 'ok' for slot in batch.slot_ids if slot.build_id)" t-set="klass">success</t>
      <t t-if="batch.state=='done' and any(slot.build_id.global_result in ('ko', 'warn') for slot in batch.slot_ids)" t-set="klass">danger</t>

      <div t-attf-class="batch_tile {{'more' if more else 'nomore'}}">
        <div t-attf-class="card bg-{{klass}}-light">
          <div class="batch_header">
            <a t-attf-href="/runbot/batch/#{batch.id}" t-attf-class="badge badge-{{'warning' if batch.has_warning else 'light'}}" title="View Batch">
              <t t-esc="batch.get_formated_age()"/>
              <i class="fa fa-exclamation-triangle" t-if="batch.has_warning"/>
              <i class="arrow fa fa-window-maximize"/>
            </a>
          </div>
          <t t-if="batch.state=='preparing'">
            <span><i class="fa fa-cog fa-spin fa-fw"/> preparing</span>
          </t>
          <div class="batch_slots">
            <t t-foreach="batch.slot_ids" t-as="slot">
              <t t-if="slot.build_id">
                <div t-if="not slot.trigger_id.manual and ((not slot.trigger_id.hide and trigger_display is None) or (trigger_display and slot.trigger_id.id in trigger_display))or slot.build_id.global_result == 'ko'"
                  t-call="runbot.slot_button" class="slot_container"/>
              </t>
            </t>
            <div class="slot_filler" t-foreach="range(10)" t-as="x"/>
          </div>
          <div class="batch_commits">
            <div t-foreach="batch.commit_link_ids.sorted(lambda cl: (cl.commit_id.repo_id.sequence, cl.commit_id.repo_id.id))" t-as="commit_link" class="one_line">

              <a t-attf-href="/runbot/commit/#{commit_link.commit_id.id}" t-attf-class="badge badge-light batch_commit match_type_{{commit_link.match_type}}">
                <i class="fa fa-fw fa-hashtag" t-if="commit_link.match_type == 'new'" title="This commit is a new head"/>
                <i class="fa fa-fw fa-link" t-if="commit_link.match_type == 'head'" title="This commit is an existing head from bundle branches"/>
                <i class="fa fa-fw fa-code-fork" t-if="commit_link.match_type == 'base_match'" title="This commit is matched from a base batch with matching merge_base"/>
                <i class="fa fa-fw fa-clock-o" t-if="commit_link.match_type == 'base_head'" title="This commit is the head of a base branch"/>
                <t t-esc="commit_link.commit_id.dname"/>
              </a>
              <a t-att-href="'https://%s/commit/%s' % (commit_link.branch_id.remote_id.base_url, commit_link.commit_id.name)" class="badge badge-light" title="View Commit on Github"><i class="fa fa-github"/></a>
              <span t-esc="commit_link.commit_id.subject"/>
            </div>
          </div>
        </div>
      </div>
    </template>

  </data>
</odoo>
